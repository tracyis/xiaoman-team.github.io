<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    hostname: new URL('https://xiaoman-team.github.io').hostname,
    root: '/',
    scheme: 'Muse',
    version: '7.6.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    comments: {"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: '',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}
  };
</script>

  <meta property="og:type" content="website">
<meta property="og:title" content="Xiaoman Team Blog">
<meta property="og:url" content="https://xiaoman-team.github.io/index.html">
<meta property="og:site_name" content="Xiaoman Team Blog">
<meta property="article:author" content="Xiaoman mobile Team">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://xiaoman-team.github.io/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: true,
    isPost: false
  };
</script>

  <title>Xiaoman Team Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Xiaoman Team Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>Archives</a>

  </li>
  </ul>

</nav>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://xiaoman-team.github.io/2020/03/30/swift5-2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Xiaoman mobile Team">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiaoman Team Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/03/30/swift5-2/" class="post-title-link" itemprop="url">Swift 5.2 新特性</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-03-30 06:31:52" itemprop="dateCreated datePublished" datetime="2020-03-30T06:31:52+00:00">2020-03-30</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Swift-5-2新特性"><a href="#Swift-5-2新特性" class="headerlink" title="Swift 5.2新特性"></a>Swift 5.2新特性</h1><p>2020年3月25日，随着Xcode 11.4的开放下载，Swift 5.2也正式发布了。</p>
<p><em>该版本专注于改善开发人员体验：</em></p>
<ul>
<li>提升编译器诊断（错误和警告）和代码补全效率</li>
<li>提高Debug的可靠性</li>
<li>改进了Swift Package Manager中依赖的处理</li>
<li>LSP和SwiftSyntax的工具改进</li>
<li>…</li>
</ul>
<h2 id="语言更新"><a href="#语言更新" class="headerlink" title="语言更新"></a>语言更新</h2><p>Swift 5.2实现了下列提案：</p>
<ul>
<li><a href="https://github.com/apple/swift-evolution/blob/master/proposals/0249-key-path-literal-function-expressions.md" target="_blank" rel="noopener">[SE-0249]</a>通过Key Path表达式声明函数</li>
<li><a href="https://github.com/apple/swift-evolution/blob/master/proposals/0253-callable.md" target="_blank" rel="noopener">[SE-0253]</a>自定义可调用标称类型</li>
</ul>
<p>以及其他语言特性：</p>
<ul>
<li>下标支持默认参数</li>
<li>Lazy filter顺序调整</li>
</ul>
<h2 id="改进的编译器诊断"><a href="#改进的编译器诊断" class="headerlink" title="改进的编译器诊断"></a>改进的编译器诊断</h2><p>Swift 5.2的新编译器诊断引擎解决了Swift 5.1代码错误提示中潜在的混乱消息，现在可以更好地指出需要修复的确切代码段。 </p>
<p>例如：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">E</span> </span>&#123; <span class="keyword">case</span> one, two &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">check</span><span class="params">(e: E)</span></span> &#123;</span><br><span class="line">  <span class="keyword">if</span> e != .three &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"okay"</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在Swift 5.2之前，我们会看到如下错误提示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">error: binary operator &#39;!&#x3D;&#39; cannot be applied to operands of type &#39;E&#39; and &#39;_&#39;</span><br><span class="line">  if e !&#x3D; .three &#123;</span><br><span class="line">     ~ ^  ~~~~~~</span><br></pre></td></tr></table></figure>
<p>在Swift 5.2中：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">error: type &#39;E&#39; has no member &#39;three&#39;</span><br><span class="line">  if e !&#x3D; .three &#123;</span><br><span class="line">          ~^~~~~</span><br></pre></td></tr></table></figure>
<h2 id="改进的代码补全"><a href="#改进的代码补全" class="headerlink" title="改进的代码补全"></a>改进的代码补全</h2><p>通过消除不必要的类型检查来更快地完成。对于大型文件，与Xcode 11.3.1相比，它可以将代码完成速度提高1.2倍至1.6倍，具体取决于完成位置。</p>
<p>为不完整的字典文字和不完整的三元表达式提供隐式成员的名称：</p>
<p><img src="/images/code-complete-1.png" alt=""></p>
<p>类型出现在结果中时更易于阅读。some View尽可能使用不透明的结果类型（例如），并保留类型别名，例如在Swift 5.1.3（Xcode 11.3.1）中：</p>
<p><img src="/images/code-complete-2.png" alt=""></p>
<p>在Swift 5.2（Xcode 11.4）中，现在显示为：</p>
<p><img src="/images/code-complete-3.png" alt=""></p>
<p>##编译速度提升</p>
<p><img src="/images/compilation-modes.png" alt=""></p>
<p>Swift 5.2编译器利用新的集中式逻辑来更有效地处理编译（尤其是增量编译）中的解析声明和相互引用，避免不必要的开销，从而提高性能和编译速度。</p>
<h2 id="SPM、LLDB改进以及SourceKit-LSP协议更新"><a href="#SPM、LLDB改进以及SourceKit-LSP协议更新" class="headerlink" title="SPM、LLDB改进以及SourceKit-LSP协议更新"></a>SPM、LLDB改进以及SourceKit-LSP协议更新</h2><p>Swift 5.2中的SPM使用一种新策略来解决依赖性以提高错误消息的质量和复杂依赖的性能。</p>
<h1 id="Swift-5-3呢？"><a href="#Swift-5-3呢？" class="headerlink" title="Swift 5.3呢？"></a>Swift 5.3呢？</h1><p>质量和性能增强，并增加对Windows、Linux平台的支持</p>
<h1 id="Xcode-11-4-新特性"><a href="#Xcode-11-4-新特性" class="headerlink" title="Xcode 11.4 新特性"></a>Xcode 11.4 新特性</h1><h2 id="Universal-Purchase"><a href="#Universal-Purchase" class="headerlink" title="Universal Purchase"></a>Universal Purchase</h2><p>Xcode 11.4允许开发者使用同一个Bundle ID分发macOS版本应用，以实现“通用购买”，即用户只需购买一次即可在iOS，iPadOS，macOS，watchOS和tvOS上使用应用或内购服务。</p>
<h2 id="模拟器支持iPadOS的指针捕获"><a href="#模拟器支持iPadOS的指针捕获" class="headerlink" title="模拟器支持iPadOS的指针捕获"></a>模拟器支持iPadOS的指针捕获</h2><p>UIButton、手势添加代表“指针按钮”的Point属性</p>
<h2 id="模拟器支持拖拽APNs文件模拟远程推送通知"><a href="#模拟器支持拖拽APNs文件模拟远程推送通知" class="headerlink" title="模拟器支持拖拽APNs文件模拟远程推送通知"></a>模拟器支持拖拽APNs文件模拟远程推送通知</h2><p>也可以使用命令行：<br><code>xcrun simctl push &lt;device&gt; com.example.my-app ExamplePush.apns</code></p>
<blockquote>
<p>参考：</p>
<p><a href="https://swift.org/blog/swift-5-2-released/" target="_blank" rel="noopener">swift.org - Swift 5.2 Released!</a></p>
<p><a href="https://developer.apple.com/documentation/xcode_release_notes/xcode_11_4_release_notes" target="_blank" rel="noopener">Apple Developer - Xcode 11.4 Release Notes</a></p>
<p><a href="https://developer.apple.com/support/universal-purchase/" target="_blank" rel="noopener">Apple Developer - Offering Universal Purchase</a></p>
<p><a href="https://github.com/twostraws/whats-new-in-swift-5-2" target="_blank" rel="noopener">GitHub - What’s new in Swift 5.2?</a></p>
<p><a href="https://www.swiftbysundell.com/articles/exploring-swift-5-2s-new-functional-features/" target="_blank" rel="noopener">swift by sundell - Exploring Swift 5.2’s new functional features</a></p>
</blockquote>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://xiaoman-team.github.io/2020/03/12/ios-framework-tool/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Xiaoman mobile Team">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiaoman Team Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/03/12/ios-framework-tool/" class="post-title-link" itemprop="url">组件开发工具总结</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-03-12 02:59:13" itemprop="dateCreated datePublished" datetime="2020-03-12T02:59:13+00:00">2020-03-12</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <pre><code>作者: Bobo
- Cocoapods 1.9.0
- Carthage 0.34.0
- Xcode 11.3.1
</code></pre><h2 id="选择Carthage的理由"><a href="#选择Carthage的理由" class="headerlink" title="选择Carthage的理由"></a>选择Carthage的理由</h2><ol>
<li>去中心化，预编译特性</li>
<li>更新兼容了Swift 5编译</li>
<li>尝试同步开发的另一种选择</li>
</ol>
<h2 id="如何使用Carthage开发组件"><a href="#如何使用Carthage开发组件" class="headerlink" title="如何使用Carthage开发组件"></a>如何使用Carthage开发组件</h2><ol>
<li>安装指引 <a href="https://github.com/Carthage/Carthage#installing-carthage" target="_blank" rel="noopener">https://github.com/Carthage/Carthage#installing-carthage</a></li>
<li>framework 链接问题，因为有的target的General里没有Link选项，所以统一使用BuildPhase的Link Binary with Libraries</li>
<li>私有库包含其他库的是否需要copy-frameworks script，不需要，因为最终链接的地方是主项目，私有库copy会导致嵌套引入</li>
<li>同步开发，Carthage的file模式并不能很好的支持本地同步开发；<a href="https://www.mokacoding.com/blog/carthage-no-build/" target="_blank" rel="noopener">https://www.mokacoding.com/blog/carthage-no-build/</a> 此文章提出的“弱使用”加上submodule的引入方式根本上是使用Xcode workspace集成开发，而这种方式有不少缺点，比如名字空间冲突，build setting重复设置等等</li>
</ol>
<h2 id="Carthage的问题"><a href="#Carthage的问题" class="headerlink" title="Carthage的问题"></a>Carthage的问题</h2><ol>
<li>慢，可用Terminal proxy解决</li>
<li>版本冲突，库没有版本依赖的声明，最终在主项目使用一个版本的库，会出现代码不兼容的情况；和pod引入的同一库也存在不同版本并存的问题</li>
<li>动态link，有的库有动态依赖的问题，编译时不能发现错误，但实际缺少库运行app会报“dyld __abort_with_payload”问题</li>
</ol>
<h2 id="Cocoapods常用命令"><a href="#Cocoapods常用命令" class="headerlink" title="Cocoapods常用命令"></a>Cocoapods常用命令</h2><ol>
<li>创建组件，<code>pod lib create</code></li>
<li>验证，<code>pod spec lint --sources=&#39;xxx&#39; --allow-warnings</code></li>
<li>上传，<code>pod repo push OKSpecs SPECS_NAME.podspec --sources=&#39;xxx&#39; --allow-warnings</code></li>
</ol>
<h2 id="SwiftPM"><a href="#SwiftPM" class="headerlink" title="SwiftPM"></a>SwiftPM</h2><h3 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h3><ol>
<li>原生Xcode支持，没有类似Podfile，Package.resolved文件则对应lockfile</li>
<li>Package.swift没有version字段，所以私有库更新并不需要管理version/tag，也没有spec仓库管理</li>
<li>测试方便</li>
</ol>
<h3 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h3><ol>
<li>不支持oc(貌似已经支持)，不支持resource</li>
<li>慢，xcode fetch/install比pod install慢很多，包括更新，也无法单独更新，无法手动控制安装</li>
<li>源文件相比Pods/文件夹，存在derived data，一旦删掉，需要重新fetch</li>
</ol>
<h3 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h3><p>不适合复杂混编项目，适合小型项目，适合编写纯逻辑的swift库<br> PS: <a href="https://forums.swift.org/t/how-to-add-local-swift-package-as-dependency/26457/7" target="_blank" rel="noopener">https://forums.swift.org/t/how-to-add-local-swift-package-as-dependency/26457/7</a></p>
<h2 id="组件的版本-tag-管理"><a href="#组件的版本-tag-管理" class="headerlink" title="组件的版本(tag)管理"></a>组件的版本(tag)管理</h2><ol>
<li>主项目使用branch模式，拉取最新代码，也可以用于feature分支开发</li>
<li>什么时候需要更新tag，组件有互相依赖时，比如OKWorkbench依赖OKCore，这时候OKCore需要更新的话就需要升级tag</li>
<li>组件的开发都应该优先在主项目切换为path模式做本地开发</li>
<li>什么时候应该上传tag的更新，一个功能相关的组件全部开发完毕时，这样能保证不会过于频繁的升级组件版本</li>
</ol>
<h2 id="组件设计"><a href="#组件设计" class="headerlink" title="组件设计"></a>组件设计</h2><ol>
<li>现阶段组件都是为主项目服务</li>
<li>组件应尽量具有单一性，可单独测试性，应尽量避免为了使用组件的一个小部分引入整个组件的情况出现</li>
<li>应避免组件互相之间嵌套依赖，比如OKNetwork依赖OKCore，OKWorkbench依赖OKNetwork和OKCore，此时只需要保持OKWorkbench对OKNetwork依赖即可，避免多版本冲突，第三方库同理</li>
<li>组件内的命名应保留名字空间，单独可阅读，避免使用过长的名字空间取名，比如OKCore.A.B.C…</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://xiaoman-team.github.io/2020/03/12/ios-localization/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Xiaoman mobile Team">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiaoman Team Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/03/12/ios-localization/" class="post-title-link" itemprop="url">iOS多语言开发探讨</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-03-12 02:44:43" itemprop="dateCreated datePublished" datetime="2020-03-12T02:44:43+00:00">2020-03-12</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <pre><code>作者: Hackice
</code></pre><h2 id="国际化与本地化"><a href="#国际化与本地化" class="headerlink" title="国际化与本地化"></a>国际化与本地化</h2><blockquote>
<p>国际化是指在设计软件，将软件与特定语言及地区脱钩的过程。当软件被移植到不同的语言及地区时，软件本身不用做内部工程上的改变或修正。本地化则是指当移植软件时，加上与特定区域设置有关的信息和翻译文件的过程。<br>——《维基百科》</p>
</blockquote>
<p>国际化意味着产品有适用于任何地方的“潜力”；本地化则是为了更适合于“特定”地方的使用。</p>
<h2 id="项目中国际化方式"><a href="#项目中国际化方式" class="headerlink" title="项目中国际化方式"></a>项目中国际化方式</h2><ol>
<li>静态字符串（.strings），通过调用Bundle的<code>localizedString(forKey: String, value: String, table: String)</code>方法实现国际化</li>
<li>资源：xib/asset/info.plist</li>
<li>语言包：xcloc</li>
</ol>
<h2 id="New"><a href="#New" class="headerlink" title="New"></a>New</h2><ul>
<li><strong>iOS 13中用户可以针对每一个应用单独的设置语言选项</strong><img src="/images/ios_localization_01.jpg" alt=""></li>
<li><strong>获取当前语言设置</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 系统设置中的语言偏好列表</span><br><span class="line">Locale.preferredLanguages</span><br><span class="line">&#x2F;&#x2F; 应用支持语言的偏好选项</span><br><span class="line">Bundle.main.preferredLocalizations.first</span><br><span class="line">&#x2F;&#x2F; 指定范围语言中的偏好</span><br><span class="line">Bundle.preferredLocalizations(from: [String]).first</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>Test Plan导出包含上下文的语言包信息</strong><img src="/images/ios_localization_02.jpg" alt=""></li>
</ul>
<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><ol>
<li>当前国际化依赖手动维护各个语种的字符串文件（.strings），从调用难易度、容错、可维护性，有没有更好的方案</li>
<li>Interface Builder中国际化的处理，比如文本和图片</li>
<li>app语言切换</li>
</ol>
<h3 id="参考："><a href="#参考：" class="headerlink" title="参考："></a>参考：</h3><blockquote>
<p><a href="https://developer.apple.com/videos/play/wwdc2019/403/" target="_blank" rel="noopener">Creating Great Localized Experiences with Xcode 11</a> WWDC19</p>
<p><a href="https://buildingvts.com/clean-ios-localizable-files-8b910413b985" target="_blank" rel="noopener">Clean iOS Localizable Files</a> medium</p>
<p><a href="https://medium.com/stash-engineering/how-to-keep-your-ios-localizable-files-clean-swift-script-edition-a01bc649ef1d" target="_blank" rel="noopener">How to keep your iOS localizable files clean</a> medium</p>
<p><a href="https://www.objc.io/issues/9-strings/string-localization/" target="_blank" rel="noopener">String Localization</a> objc.io</p>
</blockquote>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://xiaoman-team.github.io/2019/12/16/use-rxandroidlive-replace-livedata/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Xiaoman mobile Team">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiaoman Team Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/12/16/use-rxandroidlive-replace-livedata/" class="post-title-link" itemprop="url">使用RxAndroidLive来实现Livedata的功能</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-12-16 08:03:28" itemprop="dateCreated datePublished" datetime="2019-12-16T08:03:28+00:00">2019-12-16</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>本文不讲细节，只讲功能，因为细节上，很多前人的库都已经有完美的实现了。我们只是做了整合并实现我们需要的功能<br>AndroidX中的生命周期组件，Livedata，是个很好用的功能。但是在Rxjava中，很多生命周期组件，都只能解绑，不能进行延迟触发与缓存，以及重订阅</p>
<h1 id="LiveData的功能"><a href="#LiveData的功能" class="headerlink" title="LiveData的功能"></a>LiveData的功能</h1><h2 id="延迟触发"><a href="#延迟触发" class="headerlink" title="延迟触发"></a>延迟触发</h2><p>什么是延迟触发？在Livedata中，有两个方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">protected void onActive() &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">protected void onInactive() &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这两个方法，一个是在生命周期onStart之后执行，一个是在生命周期onStop执行，所谓延迟触发是，我在onCreate的时候就已经对LiveData进行订阅，但实际触发请求，是在onStart之后调用onActive之后才进行的数据请求。则为延迟触发。这里的好处是，写在Fragment的onCreate数据订阅，在onStart之后才开始请求数据，这样保证数据到达界面时，界面可用，满足在onCreate时进行数据请求能保证数据到达界面时界面可用</p>
<h2 id="缓存"><a href="#缓存" class="headerlink" title="缓存"></a>缓存</h2><p>什么是缓存，Livedata的经典功能，不管订阅数据在后台如何快速发送，当界面可用的时候，都像界面层推送最后一个缓存数据。</p>
<h2 id="重订阅"><a href="#重订阅" class="headerlink" title="重订阅"></a>重订阅</h2><p>什么是重订阅？比如，代码中，需要在onStart之后开始获取数据，但是当onInactive的时候关掉数据获取，然后当我界面在可用进入onStart时，再次像数据源订阅，解决界面在压栈之后还频繁更新数据。</p>
<h2 id="主线程管理"><a href="#主线程管理" class="headerlink" title="主线程管理"></a>主线程管理</h2><p>在Livedata订阅的数据，接收者都能在主线程直接更新UI</p>
<h1 id="RxAndroidLive"><a href="#RxAndroidLive" class="headerlink" title="RxAndroidLive"></a>RxAndroidLive</h1><p>根据目前需要的需求，要实现Livedata的这些功能遍历在Rxjava上的实现，为什么要这么实现，因为Livedata没有很好的错误处理，所以我们需要在RxJava上实现这些界面需要的，我们原本使用非白白的Live组件，但是这个组件只实线了缓存功能，以及仅仅实现了Observable组件，这对我们整个系统的逻辑不完善，所以我们改进并实现了重订阅以及延迟触发机制还有线程管理。解决Android整个生命周期问题。</p>
<h2 id="引入"><a href="#引入" class="headerlink" title="引入"></a>引入</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">repositories &#123;</span><br><span class="line">    jcenter()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dependencies &#123;</span><br><span class="line">    implementation &#39;cn.xiaoman.library.android:rxandroidlive:1.0.0&#39;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="代码使用"><a href="#代码使用" class="headerlink" title="代码使用"></a>代码使用</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">Flowable.interval(1, TimeUnit.SECONDS)</span><br><span class="line">   .compose(RxAndroidLive.&lt;Long&gt;bindLifecycle(this, true, AndroidSchedulers.mainThread()))</span><br><span class="line">   .subscribe(new Subscriber&lt;Long&gt;() &#123;</span><br><span class="line">        @Override</span><br><span class="line">        public void onSubscribe(Subscription s) &#123;</span><br><span class="line">            addContent(&quot;Flowable onSubscribe&quot;);</span><br><span class="line">            final int requestNum &#x3D; 10;</span><br><span class="line">            s.request(requestNum);</span><br><span class="line">            addContent(&quot;Flowable request &quot; + requestNum);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        public void onNext(Long aLong) &#123;</span><br><span class="line">            addContent(&quot;Flowable onNext value &quot; + aLong);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        public void onError(Throwable t) &#123;</span><br><span class="line">            addContent(&quot;Flowable onError&quot;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        public void onComplete() &#123;</span><br><span class="line">            addContent(&quot;Flowable onComplete&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">   &#125;);</span><br></pre></td></tr></table></figure>
<h2 id="参数解析"><a href="#参数解析" class="headerlink" title="参数解析"></a>参数解析</h2><ol>
<li>默认实现onActive感知，只有当onStart状态之后，才会向上订阅数据</li>
<li>当autoRestart成立时，生命周期经历stop之后取消上层订阅，对界面层订阅不中断，重新进行livedata的onstart时，重新订阅数据</li>
<li>当界面不可用时，默认缓存最后一次数据，当界面可用时抛出最后一次数据</li>
<li>autoRestart 参数仅仅在可持续订阅数据库可用（Observable，Flowable）</li>
<li>Scheduler 参数指定rxjava后面数据流的所在线程，一般自己指定为主线程（若不指定，线程可能会因为生命周期问题，进行线程飘逸，因为生命周期属于主线程触发，后台数据上抛可能处于子线程）</li>
</ol>
<h1 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h1><p>项目已开源，<a href="https://github.com/xiaoman-team/RxAndroidLive" target="_blank" rel="noopener">源码在这</a></p>
<h1 id="感谢"><a href="#感谢" class="headerlink" title="感谢"></a>感谢</h1><p>AndroidX LiveData</p>
<p><a href="https://listenzz.github.io/android-lifecyle-works-perfectly-with-rxjava.html" target="_blank" rel="noopener">Android 生命周期架构组件与 RxJava 完美协作</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://xiaoman-team.github.io/2019/01/03/carthage_private_framework/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Xiaoman mobile Team">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiaoman Team Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/01/03/carthage_private_framework/" class="post-title-link" itemprop="url">如何使用 Carthage 集成私有 framework</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-01-03 09:01:47" itemprop="dateCreated datePublished" datetime="2019-01-03T09:01:47+00:00">2019-01-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-01-08 09:03:36" itemprop="dateModified" datetime="2019-01-08T09:03:36+00:00">2019-01-08</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <pre><code>行文环境
- Xcode 10.1
- Carthage 0.31.2
</code></pre><h2 id="Carthage"><a href="#Carthage" class="headerlink" title="Carthage"></a>Carthage</h2><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>Carthage 是 swift 开发的代码依赖工具，与Cocoapods直接引入第三方源代码并修改 Xcode workspace 不同，Carthage 是将第三方库预先 build 好的 framework 引入工程。这样更适合大型项目，预先编译好的 framework 不需要重新编译。</p>
<h3 id="快速使用"><a href="#快速使用" class="headerlink" title="快速使用"></a>快速使用</h3><ol>
<li>安装 <code>brew install carthage</code></li>
<li>在工程目录下创建 <code>Cartfile</code></li>
<li>在 <code>Cartfile</code> 里添加依赖库，比如 <code>github &quot;Alamofire/Alamofire&quot; ~&gt; 4.7.2</code></li>
<li>运行 <code>carthage update</code></li>
<li>会生成 <code>Cartfile.resolved</code> 和 Carthage 文件夹 包括 Build 和 Checkout</li>
<li><p>添加 framework 到工程，在 Build Phases 里新建 New Run Script Phase，输入：<br> <code>/usr/local/bin/carthage copy-frameworks</code></p>
<p> 在 <code>Input Files</code> 项里填入 </p>
<p> <code>$(SRCROOT)/Carthage/Build/iOS/Alamofire.framework</code></p>
<p> 在 <code>Output Files</code> 项里填入 </p>
<p> <code>$(BUILT_PRODUCTS_DIR)/$(FRAMEWORKS_FOLDER_PATH)/Alamofire.framework</code></p>
</li>
</ol>
<h3 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h3><p><code>carthage update</code> 更新并重新编译 framework</p>
<p><code>carthage bootstrap</code> 类似 update，一般用于新 checkout 的仓库第一次运行 carthage</p>
<p><code>--platform iOS</code> build 平台参数</p>
<p><code>--cache-builds</code> build 时使用缓存</p>
<p><code>carthage build --no-skip-current</code> build private framework</p>
<h3 id="Cartfile"><a href="#Cartfile" class="headerlink" title="Cartfile"></a>Cartfile</h3><p>引用github库 <code>github &quot;Alamofire/Alamofire&quot; ~&gt; 4.7.2</code></p>
<p>指定具体tag <code>github &quot;malcommac/SwiftDate&quot; == 4.5.1</code> </p>
<p>指定分支 <code>github &quot;XiaomaniOS/RichEditorView&quot; &quot;xiaoman&quot;</code></p>
<p>私有仓库 <code>git &quot;ssh://git@git.xiaoman.co:7999/im/xmprotobuf.git&quot;</code></p>
<p>本地仓库 <code>git &quot;file:///Users/neilpa/code/project&quot; &quot;branch&quot;</code></p>
<h3 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h3><ul>
<li>第一次 build 时间很长（喝杯咖啡先）</li>
<li>CI 运行 <code>carthage update</code> 费时，使用 <code>--cache-builds</code> 加快效率</li>
<li>没有 Cocoapods 的各种其他功能</li>
</ul>
<h2 id="创建私有-framework"><a href="#创建私有-framework" class="headerlink" title="创建私有 framework"></a>创建私有 framework</h2><h3 id="新建项目"><a href="#新建项目" class="headerlink" title="新建项目"></a>新建项目</h3><p>新建 <strong>Cocoa Touch Framework</strong> 的项目</p>
<p>将 framework 的 scheme 设置成 shared，这里有个坑，新创建的项目 Xcode 不会生成 <code>.xcscheme</code> 文件，carthage 需要找这个文件来选择哪些 scheme 需要 build，所以需要修改一下 scheme 让 git 里生成<code>.xcscheme</code> 文件</p>
<p>设置 <code>General</code> -&gt; <code>Deployment Target</code></p>
<h3 id="添加代码"><a href="#添加代码" class="headerlink" title="添加代码"></a>添加代码</h3><p>将源代码加入工程，确保需要暴露的类等是 public 的，因为默认是 internal，外部无法识别</p>
<p>Objective-C代码需要设置header为Public<br><img src="https://static1.squarespace.com/static/53699711e4b052b073e44f1f/t/59f26cb727ef2db556c3648f/1509059778262/target-membership.png" alt=""></p>
<p>私有 framework 如果有依赖库可以使用 Carthage 添加，主工程使用私有 framework 时也会 build 出依赖的 framework</p>
<h3 id="编译"><a href="#编译" class="headerlink" title="编译"></a>编译</h3><p><code>carthage build --no-skip-current</code></p>
<p>如果有错参考 <a href="https://github.com/Carthage/Carthage#resolve-build-failures" target="_blank" rel="noopener">Resolve build failures</a></p>
<p>如果提示找不到 scheme，检查上面提到的 <code>.xcscheme</code> 文件有没有提交到 git</p>
<p>成功后打 git tag，Carthage 用 tag 来定位代码</p>
<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><p>用上面提到的方法加入到主工程即可，注意依赖库也需要添加</p>
<h2 id="Read-More"><a href="#Read-More" class="headerlink" title="Read More"></a>Read More</h2><h3 id="Carthage-1"><a href="#Carthage-1" class="headerlink" title="Carthage"></a>Carthage</h3><ul>
<li><a href="https://github.com/Carthage/Carthage#resolve-build-failures" target="_blank" rel="noopener">Carthage/Carthage</a></li>
<li><a href="http://shashikantjagtap.net/carthage-cocoapods-question/" target="_blank" rel="noopener">Carthage or CocoaPods: That is the question</a></li>
<li><a href="https://samwize.com/2018/06/27/creating-a-private-framework-with-carthage/" target="_blank" rel="noopener">Creating a Private Framework With Carthage</a></li>
<li><a href="https://github.com/Carthage/Carthage/issues/398" target="_blank" rel="noopener">Local Git Repos?</a></li>
<li><a href="https://github.com/Carthage/Carthage/issues/844" target="_blank" rel="noopener">Nested Frameworks?</a></li>
<li><a href="https://github.com/Carthage/Carthage/issues/848" target="_blank" rel="noopener">bootstrap vs update?</a></li>
<li><a href="https://github.com/travis-ci/travis-ci/issues/4195" target="_blank" rel="noopener">Github API rate limit reached when building iOS project with Carthage</a></li>
<li><a href="http://shashikantjagtap.net/five-steps-migrate-ios-project-cocoapods-carthage/" target="_blank" rel="noopener">Five Steps to Migrate iOS Project from CocoaPods to Carthage</a></li>
</ul>
<h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><ul>
<li><a href="https://www.ca.com/en/blog-developers/dynamic-versus-static-framework-in-ios.html" target="_blank" rel="noopener">Dynamic Versus Static Framework in iOS</a></li>
<li><a href="https://www.raywenderlich.com/5109-creating-a-framework-for-ios" target="_blank" rel="noopener">Creating a Framework for iOS</a></li>
<li><a href="https://medium.com/flawless-app-stories/getting-started-with-reusable-frameworks-for-ios-development-f00d74827d11" target="_blank" rel="noopener">Getting Started with Reusable Frameworks for iOS Development</a></li>
<li><a href="https://github.com/JohnSundell/SwiftPlate" target="_blank" rel="noopener">JohnSundell/SwiftPlate</a></li>
<li><a href="https://guides.cocoapods.org/making/making-a-cocoapod.html" target="_blank" rel="noopener">Making a CocoaPod</a></li>
<li><a href="https://patrickbalestra.com/blog/2018/08/27/improving-your-build-time-in-xcode-10.html" target="_blank" rel="noopener">Improving Your Build Time in Xcode 10</a></li>
<li><a href="https://jobs.zalando.com/tech/blog/how-the-zalando-ios-app-abandoned-cocoapods-and-reduced-build-time/?gh_src=4n3gxh1" target="_blank" rel="noopener">How the Zalando iOS App Abandoned CocoaPods and Reduced Build Time</a></li>
<li><a href="http://www.vsanthanam.com/writing/2017/10/26/building-objective-c-frameworks" target="_blank" rel="noopener">Building Objective-C Frameworks</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://xiaoman-team.github.io/2018/12/04/snappy-for-android/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Xiaoman mobile Team">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiaoman Team Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2018/12/04/snappy-for-android/" class="post-title-link" itemprop="url">snappy for android</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-12-04 07:44:13" itemprop="dateCreated datePublished" datetime="2018-12-04T07:44:13+00:00">2018-12-04</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>移动端要做离线版的邮件缓存，我们需要同步客户的大量邮件数据到本地，因为数据量大，不在使用http已经json进行邮件协议传输，改用proto并配合snappy来做数据传输。</p>
<h1 id="Snappy"><a href="#Snappy" class="headerlink" title="Snappy"></a>Snappy</h1><p>snappy是什么？<br>好吧，我也不知道，公司要用到了，我就引用一下wikipedia的内容给各位看官看下？</p>
<blockquote>
<p>Snappy（以前称Zippy）是Google基于LZ77的思路用C++语言编写的快速数据压缩与解压程序库，并在2011年开源。它的目标并非最大压缩率或与其他压缩程序库的兼容性，而是非常高的速度和合理的压缩率。使用一个运行在64位模式下的酷睿i7处理器的单个核心，压缩速度250 MB/s，解压速度500 MB/s。压缩率比gzip低20-100%。</p>
<p>Snappy广泛应用在Google的项目，例如BigTable、MapReduce和Google内部RPC系统的压缩数据。它可在开源项目中使用，例如Cassandra、Hadoop、LevelDB、MongoDB、RocksDB和Lucene。[4]解压缩时会检测压缩流中是否存在错误。Snappy不使用内联汇编并且可移植。</p>
</blockquote>
<p>嗯，看了下介绍，知道为啥要用它了吧？为了非常高的压缩速度和合理的压缩率。</p>
<h1 id="相关项目"><a href="#相关项目" class="headerlink" title="相关项目"></a>相关项目</h1><p>嗯，我们移动端做Android项目，肯定优先找java相关的snappy实现。<br>我们找到了这样的一个项目。</p>
<p><a href="https://github.com/xerial/snappy-java" target="_blank" rel="noopener">https://github.com/xerial/snappy-java</a></p>
<p>这个项目也是使用java代码，然后来调用so库里面的c方法来进行代码压缩和解压。但是，这个打包方式，并不适合Android项目来调用，为了解决这个问题，所以有了这文章的主角</p>
<h1 id="Snappy-Android"><a href="#Snappy-Android" class="headerlink" title="Snappy-Android"></a>Snappy-Android</h1><p>嗯，我们修改了 snappy-java的源码路径，并改造成 android 项目的编译方式，用以支持 android 使用 snappy 来做压缩解压。</p>
<p>因使用的是相同的 so 动态链接库方式，使用了最新的 NDK 来编译的相应平台的动态链接库。</p>
<h2 id="支持平台"><a href="#支持平台" class="headerlink" title="支持平台"></a>支持平台</h2><p>目前使用的 NDK 编译出来的动态链接库包含 armeabi-v7a，arm64-v8a，x86，x86_64 四大平台，<br>其余平台 armeabi, mips, mips64 因为新版 NDK 编译取消支持，所以编译成品中不在支持，如果有需要，可以自己下载源码，使用旧版 ndk 进行编译打包。</p>
<h2 id="使用方式"><a href="#使用方式" class="headerlink" title="使用方式"></a>使用方式</h2><p>这里不在重新写一遍啦，详见开源项目主页<br><a href="https://github.com/xiaoman-team/snappy-android" target="_blank" rel="noopener">https://github.com/xiaoman-team/snappy-android</a></p>
<h1 id="感谢"><a href="#感谢" class="headerlink" title="感谢"></a>感谢</h1><p>再次感谢 <a href="https://github.com/google/snappy" target="_blank" rel="noopener">snappy</a> <a href="https://github.com/xerial/snappy-java" target="_blank" rel="noopener">snappy-java</a> 给我们做出这么好的产品用于商业使用，我们只是做了一下 android 的打包适配。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://xiaoman-team.github.io/2018/12/03/start-use-hexo/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Xiaoman mobile Team">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiaoman Team Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2018/12/03/start-use-hexo/" class="post-title-link" itemprop="url">初始化使用hexo</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-12-03 08:37:56" itemprop="dateCreated datePublished" datetime="2018-12-03T08:37:56+00:00">2018-12-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2018-12-04 07:44:13" itemprop="dateModified" datetime="2018-12-04T07:44:13+00:00">2018-12-04</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>团队博客的驱型基本做好了，接下来是要写一篇交大家使用的文章，这样才能让大家安心写些文档不是？<br>目前使用的博客系统，是基于nodejs的hexo静态博客生成组件。<br>好处是什么呢？是我们直接用github来托管就好了，不用自己管理空间哈。<br>接下来我们说说怎么使用我们的博客系统</p>
<h1 id="平台支持初始化"><a href="#平台支持初始化" class="headerlink" title="平台支持初始化"></a>平台支持初始化</h1><p>公司用的比较多的是mac，下面就基于苹果环境来做教程啦，你们相应的做修改哈。<br>先安装nodejs环境和博客平台环境。</p>
<h2 id="安装nodejs"><a href="#安装nodejs" class="headerlink" title="安装nodejs"></a>安装nodejs</h2><p>这个嘛，到官网下载就好了。<a href="https://nodejs.org/，作者目前使用的是11.3.0哈，安装好之后，就会有npm指令了。" target="_blank" rel="noopener">https://nodejs.org/，作者目前使用的是11.3.0哈，安装好之后，就会有npm指令了。</a></p>
<h2 id="安装hexo"><a href="#安装hexo" class="headerlink" title="安装hexo"></a>安装hexo</h2><figure class="highlight plain"><figcaption><span>install -g hexo-cli```</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">这样，博客支持程序就安装好了。</span><br><span class="line"></span><br><span class="line"># 配置网站本地环境</span><br><span class="line"></span><br><span class="line">## 下载网站源码</span><br><span class="line">&#96;&#96;&#96;git clone git@github.com:xiaoman-team&#x2F;xiaoman-team.github.io.git</span><br></pre></td></tr></table></figure>
<h2 id="获取网站源码分支"><a href="#获取网站源码分支" class="headerlink" title="获取网站源码分支"></a>获取网站源码分支</h2><p>为啥要获取，因为静态网站使用的是master分支，这个分支是试用hexo发布的，平时我们管理的文章，在source分支，为啥用这个分支？嗯，其实你也可以用其他分支不是？自己换就好了啦。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd xiaoman-team.github.io</span><br><span class="line">git checkout -b source origin&#x2F;source</span><br></pre></td></tr></table></figure>
<h2 id="初始化hexo程序"><a href="#初始化hexo程序" class="headerlink" title="初始化hexo程序"></a>初始化hexo程序</h2><figure class="highlight plain"><figcaption><span>install hexo --save```</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">到目前为止，，你就搞定了本地环境配置拉</span><br><span class="line"></span><br><span class="line"># 文章编写</span><br><span class="line">接下来，是不是改写文章了呢？好吧，我们用hexo生成一片新文章好不好？</span><br><span class="line"></span><br><span class="line">## 新文章编写</span><br><span class="line">比如这篇文章的指令是</span><br><span class="line">&#96;&#96;&#96;hexo new start-use-hexo</span><br></pre></td></tr></table></figure>
<p>当然，start-use-hexo就是文章的链接名啦，文件会生成在 _post 目录下，是 markdown 格式的。</p>
<h2 id="进入文章编写"><a href="#进入文章编写" class="headerlink" title="进入文章编写"></a>进入文章编写</h2><p>怎么写？？去_post目录下去写你的文章啦，，markdown怎么用？这不在本文讨论范围内哦，你自己去试试？</p>
<h2 id="预览文章"><a href="#预览文章" class="headerlink" title="预览文章"></a>预览文章</h2><p>使用一下命令生成静态文件来预览文章啦<br><figure class="highlight plain"><figcaption><span>g```</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">使用一下命令来打开预览服务器</span><br><span class="line">&#96;&#96;&#96;hexo s</span><br></pre></td></tr></table></figure></p>
<p>他会提示你本地打开路径，你自己打开就能预览你写好的文章啦。<br>如果有时候没生效，试试<br><code>hexo clean</code><br>在<br><code>hexo g</code></p>
<h2 id="发布文章"><a href="#发布文章" class="headerlink" title="发布文章"></a>发布文章</h2><p>也是很简单<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hexo clean</span><br><span class="line">hexo g</span><br><span class="line">hexo d</span><br></pre></td></tr></table></figure><br>请你在预览好之后，在执行 d 的命令哈。<br>该命令执行完成之后，会推送到master分支上，然后我们的网站<br> <a href="https://xiaoman-team.github.io.git" target="_blank" rel="noopener">https://xiaoman-team.github.io.git</a> 就会更新了。</p>
<h1 id="保存文章源码"><a href="#保存文章源码" class="headerlink" title="保存文章源码"></a>保存文章源码</h1><p>最后，最重要的，当然是把你的文章源码保存下来了啦。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git add source&#x2F;_posts&#x2F;start-use-hexo.md</span><br><span class="line">git commit -m &#39;add start use hexo post&#39;</span><br><span class="line">git push</span><br></pre></td></tr></table></figure></p>
<h1 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h1><p>好了，目前源码也已经保存了，文章也发布了，教程就是这么简单啦。有啥不懂的，可以提出来我们在探讨一下啦。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://xiaoman-team.github.io/2018/11/08/ios10_notification/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Xiaoman mobile Team">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiaoman Team Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2018/11/08/ios10_notification/" class="post-title-link" itemprop="url">阿里云SDK实现iOS10推送通知</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-11-08 09:11:13" itemprop="dateCreated datePublished" datetime="2018-11-08T09:11:13+00:00">2018-11-08</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <pre><code>行文环境
- Xcode 10.1
- Swfit 4.1
- iOS 12
- 阿里云
</code></pre><h2 id="证书设置"><a href="#证书设置" class="headerlink" title="证书设置"></a>证书设置</h2><p><a href="https://help.aliyun.com/document_detail/30071.html?spm=a2c4g.11186623.6.629.3e6e614cfnQxzL" target="_blank" rel="noopener">iOS推送证书设置</a></p>
<p>证书配置分为开发环境和生产环境，需要与业务服务器的开发环境（如dev/test）和正式环境区分开。例如给测试分发的Ad Hoc包使用生产环境的证书，但业务是test环境。</p>
<h3 id="Ad-Hoc包为什么收不到通知"><a href="#Ad-Hoc包为什么收不到通知" class="headerlink" title="Ad Hoc包为什么收不到通知"></a>Ad Hoc包为什么收不到通知</h3><p>因为Ad Hoc使用生产环境证书，设备的deviceToken在不同证书环境是不同的，但测试包的业务是test环境，后台会在test环境使用开发的apns设置，导致deviceToken无法匹配到对应的设备。</p>
<h2 id="payload变化"><a href="#payload变化" class="headerlink" title="payload变化"></a>payload变化</h2><p>老版本payload，只有body<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;aps&quot;: &#123;</span><br><span class="line">        &quot;alert&quot;: &#123;</span><br><span class="line">        &quot;your notification body&quot;,</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;badge&quot;: 1,</span><br><span class="line">        &quot;sound&quot;: &quot;default&quot;,</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;key1&quot;:&quot;value1&quot;,</span><br><span class="line">    &quot;key2&quot;:&quot;value2&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>新版payload，新增title、subtitle、body、category等字段<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;aps&quot;: &#123;</span><br><span class="line">        &quot;alert&quot;: &#123;</span><br><span class="line">            &quot;title&quot;: &quot;title&quot;,</span><br><span class="line">            &quot;subtitle&quot;: &quot;subtitle&quot;,</span><br><span class="line">            &quot;body&quot;: &quot;body&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;badge&quot;: 1,</span><br><span class="line">        &quot;sound&quot;: &quot;default&quot;,</span><br><span class="line">        &quot;category&quot;: &quot;test_category&quot;,</span><br><span class="line">        &quot;mutable-content&quot;: 1</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;key1&quot;:&quot;value1&quot;,</span><br><span class="line">    &quot;key2&quot;:&quot;value2&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>业务逻辑字段方式没有变化，直接加在json里</p>
<h2 id="通知实现"><a href="#通知实现" class="headerlink" title="通知实现"></a>通知实现</h2><h3 id="初始化SDK"><a href="#初始化SDK" class="headerlink" title="初始化SDK"></a>初始化SDK</h3><p>使用配置文件<code>AliyunEmasServices-Info.plist</code>直接调用<code>autoInit</code><br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">setup</span><span class="params">(<span class="number">_</span> application: UIApplication, launchOptions: [UIApplicationLaunchOptionsKey: <span class="keyword">Any</span>]?)</span></span> &#123;</span><br><span class="line">    <span class="type">CloudPushSDK</span>.autoInit &#123; result <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> result = result <span class="keyword">else</span> &#123;</span><br><span class="line">            log.error(<span class="string">"Push SDK init failed, error: result is nil!"</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> result.success &#123;</span><br><span class="line">            log.debug(<span class="string">"Push SDK init success, deviceId: \(String(describing: CloudPushSDK.getDeviceId()))"</span>)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            log.error(<span class="string">"Push SDK init failed, error: \(String(describing: result.error))"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    <span class="comment">// 点击通知将App从关闭状态启动时，将通知打开回执上报</span></span><br><span class="line">    <span class="type">CloudPushSDK</span>.sendNotificationAck(launchOptions)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="请求通知权限并注册远程通知"><a href="#请求通知权限并注册远程通知" class="headerlink" title="请求通知权限并注册远程通知"></a>请求通知权限并注册远程通知</h3><p>第一次安装会弹出请求通知的alert<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">registerAPNS</span><span class="params">(application: UIApplication)</span></span> &#123;</span><br><span class="line">    <span class="keyword">let</span> center = <span class="type">UNUserNotificationCenter</span>.current()</span><br><span class="line">    center.delegate = <span class="keyword">self</span></span><br><span class="line">    <span class="keyword">var</span> options: <span class="type">UNAuthorizationOptions</span> = [.alert, .sound, .badge]</span><br><span class="line">    <span class="keyword">if</span> #available(iOS <span class="number">12.0</span>, *) &#123;</span><br><span class="line">        options = [.alert, .sound, .badge, .providesAppNotificationSettings]</span><br><span class="line">    &#125;</span><br><span class="line">    center.requestAuthorization(options: options) &#123; (granted, error) <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">if</span> granted &#123;</span><br><span class="line">            log.debug(<span class="string">"User authored notification."</span>)</span><br><span class="line">            <span class="type">DispatchQueue</span>.main.async &#123;</span><br><span class="line">                application.registerForRemoteNotifications()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            log.debug(<span class="string">"User denied notification."</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> error = error &#123;</span><br><span class="line">            log.error(error)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="注册设备并上报deviceToken"><a href="#注册设备并上报deviceToken" class="headerlink" title="注册设备并上报deviceToken"></a>注册设备并上报deviceToken</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">registerDevice</span><span class="params">(<span class="number">_</span> deviceToken: Data)</span></span> &#123;</span><br><span class="line">    <span class="type">CloudPushSDK</span>.registerDevice(deviceToken) &#123; result <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> result = result <span class="keyword">else</span> &#123;</span><br><span class="line">            log.error(<span class="string">"Register deviceToken failed, error:: result is nil!"</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> result.success &#123;</span><br><span class="line">            log.debug(<span class="string">"Register deviceToken success, deviceToken: \(String(describing: CloudPushSDK.getApnsDeviceToken()))"</span>)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            log.debug(<span class="string">"Register deviceToken failed, error: \(String(describing: result.error))"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">application</span><span class="params">(<span class="number">_</span> application: UIApplication,</span></span></span><br><span class="line"><span class="function"><span class="params">                        didRegisterForRemoteNotificationsWithDeviceToken deviceToken: Data)</span></span> &#123;</span><br><span class="line">    registerDevice(deviceToken)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注册失败</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">application</span><span class="params">(<span class="number">_</span> application: UIApplication,</span></span></span><br><span class="line"><span class="function"><span class="params">                        didFailToRegisterForRemoteNotificationsWithError error: Error)</span></span> &#123;</span><br><span class="line">    log.error(<span class="string">"did Fail To Register For Remote Notifications With Error : \(error)"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="注册通知类别"><a href="#注册通知类别" class="headerlink" title="注册通知类别"></a>注册通知类别</h3><p>通知类别（category）用于给通知分类，可添加按钮或自定义UI<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">createCustomNotificationCategory</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">let</span> action = <span class="type">UNNotificationAction</span>(identifier: <span class="string">"actionID"</span>, title: <span class="string">"buttonTitle"</span>, options: [])</span><br><span class="line">    <span class="keyword">let</span> category = <span class="type">UNNotificationCategory</span>(identifier: <span class="string">"CategoryID"</span>, actions: [action],</span><br><span class="line">                                          intentIdentifiers: [],</span><br><span class="line">                                          options: .customDismissAction)</span><br><span class="line">    <span class="type">UNUserNotificationCenter</span>.current().setNotificationCategories([category])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="UNUserNotificationCenterDelegate"><a href="#UNUserNotificationCenterDelegate" class="headerlink" title="UNUserNotificationCenterDelegate"></a>UNUserNotificationCenterDelegate</h3><p><code>UNUserNotificationCenterDelegate</code>代替了<code>UIAppDelegate</code>的旧通知接收方法<code>didReceiveRemoteNotification</code>将接收通知的情况分为app开启时（foreground）和app不在前台时（background）</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app打开时调用</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">userNotificationCenter</span><span class="params">(<span class="number">_</span> center: UNUserNotificationCenter,</span></span></span><br><span class="line"><span class="function"><span class="params">                                   willPresent notification: UNNotification,</span></span></span><br><span class="line"><span class="function"><span class="params">                                   withCompletionHandler completionHandler: @escaping <span class="params">(UNNotificationPresentationOptions)</span></span></span> -&gt; <span class="type">Void</span>) &#123;</span><br><span class="line">    <span class="comment">// 业务逻辑</span></span><br><span class="line">    handleNotification(notification)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 通知不弹出</span></span><br><span class="line">    <span class="comment">//completionHandler([])</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 在app内弹通知</span></span><br><span class="line">    completionHandler([.badge, .alert, .sound])</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// app未打开时调用</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">userNotificationCenter</span><span class="params">(<span class="number">_</span> center: UNUserNotificationCenter, didReceive response: UNNotificationResponse, withCompletionHandler completionHandler: @escaping <span class="params">()</span></span></span> -&gt; <span class="type">Void</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> userAction = response.actionIdentifier</span><br><span class="line">    <span class="keyword">if</span> userAction == <span class="type">UNNotificationDefaultActionIdentifier</span> &#123; </span><br><span class="line">        <span class="comment">// 点击通知栏本身</span></span><br><span class="line">        log.debug(<span class="string">"User opened the notification."</span>)</span><br><span class="line"></span><br><span class="line">        handleNotification(response.notification)</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> userAction == <span class="type">UNNotificationDismissActionIdentifier</span> &#123;</span><br><span class="line">        <span class="comment">// 通知dismiss，category创建时传入UNNotificationCategoryOptionCustomDismissAction才可以触发</span></span><br><span class="line">        log.debug(<span class="string">"User dismissed the notification."</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> userAction == <span class="string">"actionID"</span> &#123;</span><br><span class="line">        <span class="comment">// 自定义按钮逻辑</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    completionHandler()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// iOS12新功能，在app系统通知设置里点击按钮跳到app内通知设置的回调</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">userNotificationCenter</span><span class="params">(<span class="number">_</span> center: UNUserNotificationCenter, openSettingsFor notification: UNNotification?)</span></span> &#123;</span><br><span class="line">    log.debug(<span class="string">"Open notification in-app setting."</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="扩展阅读"><a href="#扩展阅读" class="headerlink" title="扩展阅读"></a>扩展阅读</h4><ul>
<li><a href="https://developer.apple.com/documentation/usernotifications" target="_blank" rel="noopener">UserNotifications Document</a></li>
<li><a href="https://help.aliyun.com/document_detail/30071.html" target="_blank" rel="noopener">阿里云iOS SDK手册</a></li>
<li><a href="https://help.aliyun.com/document_detail/44666.html" target="_blank" rel="noopener">iOS10通知适配</a></li>
<li><a href="https://help.aliyun.com/knowledge_detail/54107.html" target="_blank" rel="noopener">Ad Hoc App如何进行生产环境推送通知测试</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://xiaoman-team.github.io/2018/05/08/fix-ios-crash/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Xiaoman mobile Team">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiaoman Team Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2018/05/08/fix-ios-crash/" class="post-title-link" itemprop="url">iOS 崩溃解决方案</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-05-08 10:32:08" itemprop="dateCreated datePublished" datetime="2018-05-08T10:32:08+00:00">2018-05-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2018-11-08 09:11:13" itemprop="dateModified" datetime="2018-11-08T09:11:13+00:00">2018-11-08</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <pre><code>行文环境
- Xcode 9.3
- Swfit 4.1
- iOS 11
- Bugly
</code></pre><h2 id="崩溃分析平台（Bugly）"><a href="#崩溃分析平台（Bugly）" class="headerlink" title="崩溃分析平台（Bugly）"></a>崩溃分析平台（Bugly）</h2><p>崩溃平台大多数问题就是缺失dsyMs文件，只要找到crash log对应的dsyMs文件上传重新符号化（Re-symbolicate）即可</p>
<h3 id="找到dsyMs文件的方法"><a href="#找到dsyMs文件的方法" class="headerlink" title="找到dsyMs文件的方法"></a>找到dsyMs文件的方法</h3><h4 id="本地文件"><a href="#本地文件" class="headerlink" title="本地文件"></a>本地文件</h4><p><code>mdfind &quot;com_apple_xcode_dsym_uuids == &lt;UUID&gt;&quot;</code><br>在bundle打包的电脑上使用上面的命令查找对应UUID的dsyMs文件</p>
<h4 id="xcarchives"><a href="#xcarchives" class="headerlink" title="xcarchives"></a>xcarchives</h4><p>在bundle打包的电脑上也可以在Xcode Orgnizer里找到对应Archive</p>
<p><img src="http://ios-ci.oss-cn-hangzhou.aliyuncs.com/blog/Screen%20Shot%202018-05-07%20at%204.26.10%20PM.png" alt="1"></p>
<p><img src="http://ios-ci.oss-cn-hangzhou.aliyuncs.com/blog/Screen%20Shot%202018-05-07%20at%204.32.08%20PM.png" alt="2"></p>
<p><img src="http://ios-ci.oss-cn-hangzhou.aliyuncs.com/blog/Screen%20Shot%202018-05-07%20at%204.32.16%20PM.png" alt="3"></p>
<h4 id="下载-Bitcode-dSYMs"><a href="#下载-Bitcode-dSYMs" class="headerlink" title="下载 Bitcode dSYMs"></a>下载 Bitcode dSYMs</h4><p>第一种方式是在Xcode Orgnizer</p>
<p><img src="http://ios-ci.oss-cn-hangzhou.aliyuncs.com/blog/WeChatWorkScreenshot_88a7d1d7-e92a-471f-bd60-4e64f91c9977.png" alt=""></p>
<p>第二种方式是在iTC，已发布的bundle推荐使用这种方式</p>
<p><img src="http://ios-ci.oss-cn-hangzhou.aliyuncs.com/blog/WeChatWorkScreenshot_c10ee963-8e32-4dd6-9317-851825499eb5.png" alt=""></p>
<h2 id="Crash-log"><a href="#Crash-log" class="headerlink" title="Crash log"></a>Crash log</h2><p>崩溃分析平台无法定位的崩溃可以通过直接分析crash log文件</p>
<h4 id="获取设备的crash-log"><a href="#获取设备的crash-log" class="headerlink" title="获取设备的crash log"></a>获取设备的crash log</h4><p>打开Xcode Device页面，并导出crash log</p>
<p><img src="http://ios-ci.oss-cn-hangzhou.aliyuncs.com/blog/Screen%20Shot%202018-05-07%20at%204.51.47%20PM.png" alt=""></p>
<p><img src="http://ios-ci.oss-cn-hangzhou.aliyuncs.com/blog/WeChatWorkScreenshot_b96dc51e-8b02-405a-acdb-f1306667e0b5.png" alt=""></p>
<p><img src="http://ios-ci.oss-cn-hangzhou.aliyuncs.com/blog/Screen%20Shot%202018-05-07%20at%204.55.01%20PM.png" alt=""></p>
<h4 id="dysMs文件"><a href="#dysMs文件" class="headerlink" title="dysMs文件"></a>dysMs文件</h4><p>打开crash log，第一行就是对应bundle的UUID<br><code>Incident Identifier: C2FB3056-8C2E-4141-800F-1E575858998D</code></p>
<p>使用前述的方式找到dysMs文件</p>
<h4 id="符号化"><a href="#符号化" class="headerlink" title="符号化"></a>符号化</h4><p>使用Xcode自带的一个命令行工具来符号化crash log文件</p>
<p><img src="http://ios-ci.oss-cn-hangzhou.aliyuncs.com/blog/Screen%20Shot%202018-05-07%20at%205.05.12%20PM.png" alt=""></p>
<p><code>/Applications/Xcode.app/Contents/SharedFrameworks/DVTFoundation.framework/Versions/A/Resources/</code></p>
<p>在这个路径找到该工具，将crash log、symbolicatecrash和dyMs文件夹zip包拷贝到同一目录下</p>
<p><img src="http://ios-ci.oss-cn-hangzhou.aliyuncs.com/blog/Screen%20Shot%202018-05-07%20at%205.07.39%20PM.png" alt=""></p>
<p>cd到该目录，运行如下命令<br><code>export DEVELOPER_DIR=&quot;/Applications/Xcode.app/Contents/Developer&quot;</code></p>
<p>符号化<br><code>./symbolicatecrash myCrash.crash &gt; SymbolicatedM.crash</code></p>
<p>done</p>
<h2 id="更多"><a href="#更多" class="headerlink" title="更多"></a>更多</h2><p>符号化之后的崩溃分析不属于本文范围</p>
<h4 id="扩展阅读"><a href="#扩展阅读" class="headerlink" title="扩展阅读"></a>扩展阅读</h4><ul>
<li><a href="https://stackoverflow.com/a/43539663/386151" target="_blank" rel="noopener">How to symbolicate crash log with Xcode 8?
</a></li>
<li><a href="https://docs.fabric.io/apple/crashlytics/missing-dsyms.html" target="_blank" rel="noopener">All about Missing dSYMs</a></li>
<li><a href="https://bugly.qq.com/docs/user-guide/symbol-configuration-ios/?v=20180119105842" target="_blank" rel="noopener">Bugly iOS 符号表配置</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

  </div>

  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Xiaoman mobile Team</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">9</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Xiaoman mobile Team</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> v4.2.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">Theme – <a href="https://muse.theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v7.6.0
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
